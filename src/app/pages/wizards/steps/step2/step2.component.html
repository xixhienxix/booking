
<div class="row">
<h5 style="font-weight: bold;"> Se encontraron {{habitaciones.length}} habitaciones disponibles para su busqueda del: {{intialDate | date:'dd/MM/yyyy'}} - {{endDate | date:'dd/MM/yyyy'}} <span style="color: red;">{{totalNights}}</span> Noches </h5>
</div>
<div class="row">
<h5 style="font-weight: bold;">Todos los precios se presentan en MXN (MX$ Pesos Mexicanos) y ya incluyen impuestos de Mexico (IVA (16%) + ISH (3%))</h5>
</div>
<ng-container *ngFor="let dispo of habitaciones; let x = index">
    <!-- Habitación Card -->
    <div class="habitacion-card">
        <div class="room-info">
            <!-- Imagen -->
            <div class="room-image" [ngStyle]="{ 'background-image': 'url(' + dispo.URL + ')' }"></div>

            <!-- Info -->
            <div class="room-details">
                <h2 class="room-code">{{ dispo.Codigo.replace('_', ' ') }}</h2>

                <p class="room-desc">{{ dispo.Descripcion }}</p>

                <div class="max-ocupacion">
                    <span><strong>Máx. Adultos:</strong> {{ dispo.Adultos }}</span> |
                    <span><strong>Máx. Niños:</strong> {{ dispo.Ninos }}</span>
                </div>

                <!-- Amenidades -->
                <div class="amenidades">
                    <ng-container *ngFor="let amenidad of dispo.Amenidades">
                        <div class="amenidad-item">
                            <img src="../../../../../assets/media/icons/custom/{{ amenidad }}.png" [alt]="amenidad" />
                            <span>{{ amenidad }}</span>
                        </div>
                    </ng-container>
                </div>
            </div>
        </div>

        <!-- Tarifas Disponibles -->
        <div class="tarifas-container">
            <div class="tarifas-header">
                <h4 class="tarifas-title">Tarifas Disponibles</h4>

            </div>
            <!-- <div class="noches-info">
                <small>
                    Tarifa basada en <strong>{{ totalNights }}</strong>
                    {{ totalNights === 1 ? 'noche' : 'noches' }}
                </small>
            </div> -->
            <ng-container *ngFor="let tarifas of tarifasArray">
                <ng-container *ngIf="tarifas.Habitacion.includes(dispo.Codigo)">
                    <div class="tarifa-row">

                        <!-- Left side: Tarifa name + "Regular" label -->
                        <!-- Left group unchanged -->
                        <div class="tarifa-info" style="flex: 1 1 300px;">
                            <div class="tarifa-nombre">{{ tarifas.Tarifa }}</div>
                            <div class="precio-regular-row" style="display: flex; gap: 1rem; margin-top: 0.3rem;">
                                <div class="precio-regular">
                                    <small>Regular</small>
                                    <span class="monto" style="color: red; text-decoration: line-through;">
                                        {{ roundUp(ratesToCalc(tarifas, false, dispo.Codigo))*1.2 |
                                        currency:
                                        'MXN':'symbol':'1.0-0' }}
                                    </span>
                                </div>
                                <div class="precio-regular">
                                    <small>Descuento</small>
                                    <span class="monto" style="color: rgb(111, 168, 25);">
                                        {{ roundUp(ratesToCalc(tarifas, false, dispo.Codigo)) | currency:
                                        'MXN':'symbol':'1.0-0' }}
                                    </span>
                                </div>
                            </div>
                        </div>

                        <!-- Total separate on right -->
                        <div class="precio-wrapper"
                            style="min-width: 120px; display: flex; flex-direction: column; justify-content: flex-start; align-items: center;">
                            <span style="font-weight: bold; font-size: 1.5rem;">
                                {{ roundUp(ratesToCalc(tarifas, false, dispo.Codigo))*totalNights | currency: '':'symbol':'1.0-0' }}
                            </span>
                        </div>



                        <div class="select-group" style=" display: flex; flex-direction: column; gap: 0.5rem;">

                            <!-- Top row: two dropdowns side by side -->
                            <div style="display: flex; gap: 0.5rem; justify-content: space-between;">
                                <!--Adutlos-->
                                <div style="flex: 1;">
                                    <label for="numPpl-{{ dispo.Codigo }}-{{ tarifas.Tarifa }}" [ngStyle]="{
                                    color: qty > getMaxFromAdultos(dispo.Codigo) ? 'red' : 'inherit'
                                    }"
                                        style="display: inline-flex; align-items: center; gap: 4px; white-space: nowrap;">
                                        Adultos: {{ qty }}

                                        <mat-icon *ngIf="qty > getMaxFromAdultos(dispo.Codigo)"
                                            matTooltip="⚠ La cantidad de Adultos que seleccionó excede el máximo disponible para este tipo de cuarto"
                                            matTooltipPosition="right" matTooltipShowDelay="300"
                                            style="color: red; font-size: 16px; vertical-align: middle; margin-left: 4px;">
                                            warning
                                        </mat-icon>
                                    </label>

                                    <select id="numPpl-{{dispo.Codigo}}-{{tarifas.Tarifa}}" style="width: 100%;"
                                        [(ngModel)]="qty" [ngModel]="getValidQty(dispo.Codigo, qty)"
                                        (ngModelChange)="onQtyChange(dispo.Codigo)">
                                        <option *ngFor="let n of generateAdultosArray(dispo.Codigo)" [value]="n">
                                            {{ n }}
                                        </option>
                                    </select>

                                </div>
                                <!--Ninos-->
                                <div style="flex: 1;">
                                    <label for="numPpl-{{ dispo.Codigo }}-{{ tarifas.Tarifa }}" [ngStyle]="{
                                    color: qtyNin > getMaxFromNinos(dispo.Codigo) ? 'red' : 'inherit'
                                    }"
                                        style="display: inline-flex; align-items: center; gap: 4px; white-space: nowrap;">
                                        Niños: {{ qtyNin }}

                                        <mat-icon *ngIf="qtyNin > getMaxFromNinos(dispo.Codigo)"
                                            matTooltip="⚠ La cantidad de Niños que seleccionó excede el máximo disponible para este tipo de cuarto"
                                            matTooltipPosition="right" matTooltipShowDelay="300"
                                            style="color: red; font-size: 16px; vertical-align: middle; margin-left: 4px;">
                                            warning
                                        </mat-icon>
                                    </label>

                                    <select id="numPpl-{{dispo.Codigo}}-{{tarifas.Tarifa}}" style="width: 100%;"
                                        [(ngModel)]="qtyNin" [ngModel]="getValidNinQty(dispo.Codigo, qtyNin)"
                                        (ngModelChange)="onQtyChange(dispo.Codigo)">
                                        <option *ngFor="let n of generateNinosArray(dispo.Codigo)" [value]="n">
                                            {{ n }}
                                        </option>
                                    </select>

                                </div>
                                <!--Numero de Habs-->
                                <div style="flex: 1;">
                                    <label for="quedan-{{dispo.Codigo}}-{{tarifas.Tarifa}}">Quedan: <span
                                            style="color: red;">{{getMaxValue(dispo.Codigo)}}</span></label>
                                    <select [(ngModel)]="numeroHabs"
                                        (ngModelChange)="onQtyHabsChange(dispo.Codigo, $event)"
                                        id="quedan-{{dispo.Codigo}}-{{tarifas.Tarifa}}" style="width: 100%;">
                                        <option *ngFor="let num of generateInventarioArray(dispo.Codigo)" [value]="num">
                                            {{ num }}
                                        </option>
                                    </select>

                                </div>
                            </div>

                            <!-- Bottom row: button centered -->
                            <div class="btn-group" style="display: flex; justify-content: center;">
                                <button type="button"
                                    [disabled]="(+qtyNin > getMaxFromNinos(dispo.Codigo)) || (+qty > getMaxFromAdultos(dispo.Codigo))" 
                                    (click)="agregaHab(tarifas, dispo.Codigo, numeroHabs)">
                                    Agregar Habitación
                                </button>
                            </div>
                        </div>


                    </div>
                </ng-container>
            </ng-container>

        </div>
    </div>
</ng-container>